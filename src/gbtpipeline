#!/bin/bash

fullpath=`readlink -f $0`
me=`dirname $fullpath`

if [ $me = "/home/gbtpipeline/integration" ]; then
	echo "!!!!!!!!!! TEST VERSION !!!!!!!!!!!!"
        VERSION='integration'        

elif [ $me = "/home/gbtpipeline/release" ]; then
        VERSION='release'

elif [ $me = "/home/gbtpipeline/old" ]; then
        VERSION='old'
fi

if [[ "$PATH" != */home/gbtpipeline/${VERSION}* ]]
then
        PATH=/home/gbtpipeline/${VERSION}/tools:"$PATH"
fi

if [ -z "$PYTHONPATH" ]
then
        PYTHONPATH=/home/gbtpipeline/${VERSION}/contrib
        PYTHONPATH=/home/gbtpipeline/${VERSION}:"$PYTHONPATH"
else
        lclpythonpath="$PYTHONPATH"
        if [[ $lclpythonpath != */home/gbtpipeline/${VERSION}* ]]
        then
                PYTHONPATH=/home/gbtpipeline/${VERSION}/contrib:"$PYTHONPATH"
                PYTHONPATH=/home/gbtpipeline/${VERSION}:"$PYTHONPATH"
        fi
fi

export PATH
export PYTHONPATH

if [ $# -gt 0 ]; then
    echo "gbtpipeline" $*
fi

source /home/gbt7/pipeline/${VERSION}-env/bin/activate
python /home/gbtpipeline/${VERSION}/gbt_pipeline.py $*
